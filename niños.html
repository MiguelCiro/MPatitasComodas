<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="ni√±os.css">
</head>
<body>
     <div id="overlay-bg" class="overlay-bg"></div>

    <div id="side-cart" class="cart-sidebar">
        <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; font-size:16px; letter-spacing:1px;">TU CARRITO</h3>
            <button id="close-cart" class="close-btn">‚úï</button>
        </div>

        <div id="cart-items-container" class="cart-body" style="flex-grow: 1; overflow-y: auto;">
            <p style="text-align:center; color:#888; margin-top:50px;">El carrito est√° vac√≠o <br> Recuerda preguntar por disponibilidad a la hora de enviar tu carrito/pedido.</p>
        </div>

        <div style="padding:20px; border-top:1px solid #eee;">
            <button id="checkout-whatsapp" class="btn-add-cart" style="width: 100%; margin: 0;">
                FINALIZAR POR WHATSAPP
            </button>
        </div>
    </div>

    <div class="announcement-delivery">
        <div class="envio">
            <span>¬°Estrena medias hoy! Env√≠os gratis por compras superiores a $50.000 üöö</span>
            <span>¬°Estrena medias hoy! Env√≠os gratis por compras superiores a $50.000 üöö</span>
        </div>
    </div>

    <div id="search-bar" class="search-overlay">
        <div class="search-content">
            <input type="text" placeholder="¬øQu√© est√°s buscando?" id="search-input">
            <button id="close-search">‚úï</button>
        </div>
    </div>

    <div id="side-cart" class="cart-sidebar">
        <div class="cart-header">
            <h3>Tu Carrito</h3>
            <button id="close-cart">‚úï</button>
        </div>
         <div class="cart-body">
            <p>Tu carrito est√° vac√≠o.</p>
        </div>
         <div class="cart-footer">
            <button class="btn-checkout">VER CARRITO</button>
        </div>
    </div>

    <div id="overlay-bg" class="overlay-bg"></div>

    <header class="header">
        <div class="header-container">
            <div class="header-left" id="header-left">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <div class="header-logo">
                <h1 class="logo-text">
                    MPATITAS <br>
                    COMODAS <span>.CO</span>
                </h1>
            </div>

            <div class="header-icons">
                <button class="icon-btn" id="search-trigger">
                    <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>

                <button class="icon-btn" id="cart-trigger">
                    <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg>
                    <span class="cart-count">0</span>
                </button>
            </div>
        </div>    
            
            <nav id="nav-menu">
                <ul>
                    <li><a href="index.html">INICIO</a></li>
                    <li><a href="largas.html">LARGAS</a></li>
                    <li><a href="cortas.html">CORTAS</a></li>
                    <li><a href="deportivas.html">ANTIDESLIZANTES</a></li>
                    <li><a href="calentadoras.html">OVEJERAS</a></li>
                    <li><a href="compresion.html">COMPRESI√ìN</a></li>
                    <li><a href="personajes.html">PERSONAJES</a></li>
                    <li><a href="boleros.html">BOLEROS</a></li>
                </ul>
            </nav>
    </header>


    <section id="cortas" class="category-section">
        <h2 class="section-title">NI√ëOS</h2>
    
        <div class="products-grid">
            <div class="product-card">
                <div class="product-image-container">
                    <img src="ni√±os-micky-NG.PNG" loading="lazy" alt="Media Corta Ref 002">
                    <div class="product-overlay-btns">
                        <button class="btn-add-cart" data-id="c-001" data-name="Media Micky Mouse" data-price="5.000">
                            üõí
                        </button>
                    </div>
                </div>
                <div class="product-details">
                    <h3 class="product-name">Media Micky Mouse Ni√±os</h3>
                    <p class="product-price">$5.000,00</p>
                    <div class="color-options">
                        <span class="dot black" data-img="ni√±os-micky-NG.PNG" data-color="Negro"></span>
                        <span class="dot brown" data-img="ni√±os-micky-CF.PNG" data-color="Cafe"></span>
                    </div>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image-container">
                    <img src="ni√±o-conejo-bordado-BL.jpeg" loading="lazy" alt="Media Corta Ref 002">
                    <div class="product-overlay-btns">
                        <button class="btn-add-cart" data-id="c-002" data-name="Media Conejito Bordado Larga" data-price="8.000">
                            üõí
                        </button>
                    </div>
                </div>
                <div class="product-details">
                    <h3 class="product-name">Media Conejito Bordado Larga </h3>
                    <p class="product-price">$8.000,00</p>
                    <div class="color-options">
                        <span class="dot white" data-img="ni√±o-conejo-bordado-BL.jpeg" data-color="Blanco"></span>
                    </div>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image-container">
                    <img src="ni√±o-conejo-bordado-AM.jpeg" loading="lazy" alt="Media Corta Ref 002">
                    <div class="product-overlay-btns">
                        <button class="btn-add-cart" data-id="c-002" data-name="Media Conejito Bordado Tobillera" data-price="6.000">
                            üõí
                        </button>
                    </div>
                </div>
                <div class="product-details">
                    <h3 class="product-name">Media Conejito Bordado Tobillera</h3>
                    <p class="product-price">$6.000,00</p>
                    <div class="color-options">
                        <span class="dot yellow2" data-img="ni√±o-conejo-bordado-AM.jpeg" data-color="Amarillo"></span>
                    </div>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image-container">
                    <img src="ni√±o-oso-bordado-CF.jpeg" loading="lazy" alt="Media Corta Ref 002">
                    <div class="product-overlay-btns">
                        <button class="btn-add-cart" data-id="c-003" data-name="Media Ni√±o Osito Bordado" data-price="6.000">
                            üõí
                        </button>
                    </div>
                </div>
                <div class="product-details">
                    <h3 class="product-name">Media Osito Bordado</h3>
                    <p class="product-price">$6.000,00</p>
                    <div class="color-options">
                        <span class="dot brown" data-img="ni√±o-oso-bordado-CF.jpeg" data-color="Cafe"></span>
                        <span class="dot pink" data-img="ni√±o-oso-bordado-RS.jpeg" data-color="Rosado"></span>
                    </div>
                </div>
            </div>
        </div> 
    </section>

    <footer class="footer">
        <div class="footer__content-top">
    
            <div class="footer-block grid__item">
                <details id="Details-Contact" class="footer-block__details">
                    <summary class="footer-block__heading">
                        INFORMACI√ìN DE CONTACTO
                        <span class="icon-plus">+</span>
                    </summary>
                    <div class="footer-block__details-content">
                        <ul class="footer-block__list list-unstyled">
                            <li>
                                <a href="https://wa.me/573248343679" target="_blank"> +57 324 8343679 </a>
                            </li>
                            <li>
                                <a href="mailto:mpatitascomodas@gmail.com">mpatitascomodas@gmail.com</a>
                            </li>
                        </ul>
                    </div>
                </details>
            </div>

            <div class="footer-block grid__item">
                <details id="Details-Policies" class="footer-block__details">
                    <summary class="footer-block__heading">
                        POL√çTICAS Y ENV√çOS
                        <span class="icon-plus">+</span>
                    </summary>
                    <div class="footer-block__details-content">
                        <ul class="footer-block__list list-unstyled">
                            <li><a href="#">Pol√≠tica de privacidad</a></li>
                            <li><a href="#">Pol√≠tica de Cambios y Devoluciones</a></li>
                        </ul>
                    </div>
                </details>
            </div>

            <div class="footer-block grid__item">
                <details id="Details-Subscribe" class="footer-block__details">
                    <summary class="footer-block__heading">
                        SUSCR√çBETE
                        <span class="icon-plus">+</span>
                    </summary>
                    <div class="footer-block__details-content">
                        <div class="footer-block__newsletter">
                            <form class="newsletter-form">
                                <input type="email" placeholder="Email" class="field__input">
                                <button type="submit" class="newsletter-form__button">SUSCRIBIRSE</button>
                            </form>
                        </div>
                    </div>
                </details>
            </div>

        </div>

        <div class="footer__content-bottom">
            <div class="footer__copyright">
                <small>¬© 2025 MPatitas Comodas</small>
            </div>
        </div>
    </footer>

    <script>
        const menuBtn = document.getElementById('header-left');
        const navMenu = document.getElementById('nav-menu');
        const searchBtn = document.getElementById('search-trigger');
        const searchBar = document.getElementById('search-bar');
        const searchInput = document.getElementById('search-input');
        const closeSearch = document.getElementById('close-search');

        const sideCart = document.getElementById('side-cart');
        const overlay = document.getElementById('overlay-bg');
        const cartTrigger = document.getElementById('cart-trigger');
        const closeCartBtn = document.getElementById('close-cart');
        const cartCountElement = document.querySelector('.cart-count');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const checkoutBtn = document.getElementById('checkout-whatsapp');

        // ESTADO DEL CARRITO
        let cart = JSON.parse(localStorage.getItem('mpatittas_cart')) || [];

        // FUNCIONES DE INTERFAZ
        const toggleCart = (show) => {
            if(show) {
                sideCart.classList.add('active');
                overlay.classList.add('active');
            } else {
                sideCart.classList.remove('active');
                overlay.classList.remove('active');
            }
        };

        window.updateCartUI = () => {
            const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
            const totalPrice = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            
            if (cartCountElement) cartCountElement.innerText = totalItems;
            localStorage.setItem('mpatittas_cart', JSON.stringify(cart));

            if (!cartItemsContainer) return;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p style="text-align:center; color:#888; margin-top:50px; font-family:sans-serif;">El carrito est√° vac√≠o</p>';
            } else {
                let itemsHtml = cart.map(item => `
                    <div class="cart-item" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                        <div style="font-family:sans-serif;">
                            <p class="cart-item-name" style="margin:0; font-weight:bold;">${item.name}</p>
                            <p style="font-size: 0.85em; color: #e91e63; margin: 2px 0; font-weight: 500;">Color: ${item.color}</p> 
                            <p class="cart-item-price" style="margin:0;">${item.quantity} x $${item.price.toLocaleString('es-CO')}</p>
                        </div>
                        <button class="btn-remove" onclick="removeFromCart('${item.id}')" style="background:none; border:none; color:#ff5252; cursor:pointer; font-size:1.2em;">‚úï</button>
                    </div>
                `).join('');

                // CONTADOR DE DINERO POR MILES ($15.000)
                itemsHtml += `
                    <div class="cart-total-section" style="margin-top:20px; padding:15px; background:#fff0f5; border-radius:8px; text-align:right; border: 1px dashed #e91e63;">
                        <p style="margin:0; font-family:sans-serif; color:#666; font-size: 0.9em;">Total de tu pedido:</p>
                        <p style="margin:0; font-size:1.4em; font-weight:bold; font-family:sans-serif; color:#000;">$${totalPrice.toLocaleString('es-CO')}</p>
                    </div>
                `;
                
                cartItemsContainer.innerHTML = itemsHtml;
            }
        };

        // L√ìGICA DE PRODUCTOS
        window.addToCart = (id, name, price, color = "√önico") => {
            // Limpieza profunda de precio para asegurar que sea un n√∫mero operable
            const numericPrice = typeof price === 'string' ? parseFloat(price.replace(/[^0-9]/g,"")) : price;
            
            const uniqueId = `${id}-${color.replace(/\s+/g, '')}`;
            
            const existing = cart.find(i => i.id === uniqueId);
            if (existing) {
                existing.quantity += 1;
            } else {
                cart.push({ id: uniqueId, name, price: numericPrice, color, quantity: 1 });
            }
            window.updateCartUI();
            toggleCart(true);
        };

        window.removeFromCart = (id) => {
            cart = cart.filter(i => i.id != id);
            window.updateCartUI();
        };

        // EVENTOS (Clicks)
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.btn-add-cart');

            if (btn && btn.id !== 'checkout-whatsapp') {
                const id = btn.dataset.id;
                const name = btn.dataset.name;
                const price = btn.dataset.price;
                const color = btn.getAttribute('data-selected-color') || "No seleccionado";
                
                if (color === "No seleccionado") {
                    alert("¬°Por favor selecciona un color haciendo clic en los c√≠rculos de colores! ‚ú®");
                    return;
                }

                window.addToCart(id, name, price, color);
            }
        });

        // CHECKOUT WHATSAPP CON TOTAL POR MILES
        if (checkoutBtn) {
            checkoutBtn.onclick = () => {
                if (cart.length === 0) return alert("Tu carrito est√° vac√≠o");
                
                const tel = "573248343679"; 
                const costoEnvio = 5000;
                const subtotalProductos = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
                const totalPrice = subtotalProductos + costoEnvio;
                
                let msg = "¬°Hola, equipo MPatitas! üß¶‚ú®\n\nAcabo de armar mi pedido en la web:\n\n";
                
                cart.forEach(i => {
                    msg += `‚úÖ ${i.quantity}x ${i.name}\n     ‚óè Color: ${i.color}\n   ‚óè Subtotal: $${(i.price * i.quantity).toLocaleString('es-CO')}\n\n`;
                });
                
                msg += `--------------------------\n`;
                msg += `üöö Valor Domicilio: $${costoEnvio.toLocaleString('es-CO')}\n`;
                msg += `üöÄ *TOTAL A PAGAR: $${totalPrice.toLocaleString('es-CO')}*\n`;
                msg += `--------------------------\n`;
                msg += "\nüìç ¬øMe confirman disponibilidad? ¬°Gracias! üß¶üíñ";
                
                window.open(`https://wa.me/${tel}?text=${encodeURIComponent(msg)}`, '_blank');
            };
        }

        // L√ìGICA DE BOLITAS (CAPTURA EL COLOR DE TU HTML)
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('dot')) {
                const dotSeleccionado = e.target;
                const tarjetaPadre = dotSeleccionado.closest('.product-card');
                
                const nuevaRutaImagen = dotSeleccionado.getAttribute('data-img');
                const imagenProducto = tarjetaPadre.querySelector('.product-image-container img');
                if (imagenProducto && nuevaRutaImagen) {
                    imagenProducto.src = nuevaRutaImagen;
                }

                const nombreColor = dotSeleccionado.getAttribute('data-color');
                const btnCarrito = tarjetaPadre.querySelector('.btn-add-cart');
                if (btnCarrito) {
                    btnCarrito.setAttribute('data-selected-color', nombreColor);
                }

                const todasLasBolitas = tarjetaPadre.querySelectorAll('.dot');
                todasLasBolitas.forEach(d => {
                    d.style.border = "1px solid #ddd";
                    d.style.transform = "scale(1)";
                });
                dotSeleccionado.style.border = "2px solid #e91e63";
                dotSeleccionado.style.transform = "scale(1.1)";
            }
        });

        // RESTO DE FUNCIONES (MEN√ö, LUPA, ETC)
        if (menuBtn && navMenu) {
            menuBtn.addEventListener('click', () => {
                navMenu.classList.toggle('active');
                menuBtn.classList.toggle('open');
            });
        }
        if (searchBtn && searchBar) {
            searchBtn.addEventListener('click', () => {
                searchBar.classList.add('active');
                setTimeout(() => { if(searchInput) searchInput.focus(); }, 300);
            });
        }
        if (closeSearch) {
            closeSearch.addEventListener('click', () => {
                searchBar.classList.remove('active');
            });
        }
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query.length > 2) {
                        window.location.href = `buscar.html?q=${encodeURIComponent(query)}`;
                    } else {
                        alert("Por favor, escribe al menos 3 letras.");
                    }
                }
            });
        }
        if (cartTrigger) cartTrigger.onclick = () => toggleCart(true);
        if (closeCartBtn) closeCartBtn.onclick = () => toggleCart(false);
        if (overlay) overlay.onclick = () => toggleCart(false);

        window.updateCartUI();
    </script>
</body>
</html>